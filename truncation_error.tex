\documentclass[10pt, ngerman,colorback,accentcolor=tud2d]{tudreport}
\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}
\usepackage{amsmath}

\usepackage{microtype}

\usepackage{pgfplots}
\pgfplotsset{compat=1.8}

\usepackage{listings}
\begin{document}

\chapter{Truncation Error}
\label{cha:Truncation_Error}

\section{Quellterm}
\label{sec:Quellterm}


Die Taylorreihenentwicklung einer Funktion $f(x)$ um den Punkt $x_0$
liefert:

\begin{equation*}
  f(x) = f(x_0) + f'(x_0)(x-x_0) + \frac{1}{2} f''(x_0)(x-x_0)^2 + HOT
\end{equation*}

Nach Integration im Intervall $a$ bis $b$ ergibt sich:

\begin{align*}
  \int_a^b f(x) dx &= \int_a^b f(x_0) dx + \int_a^b f'(x_0)(x-x_0) dx
+ \int_a^b \frac{1}{2} f''(x_0)(x-x_0)^2 dx + HOT\\
&= f(x_0) (b-a) + f'(x_0) \frac{(b-x_0)^2-(a-x_0)^2}{2}
+ \frac{1}{2} f''(x_0) \frac{(b-x_0)^3-(a-x_0)^3}{3} +HOT
\end{align*}

Die Anwendung auf ein Kontrollvolumen mit den Randpunkten $x_e$ und
$x_w$ sowie dem Mittelpunkt $x_P$ ergibt damit die folgende Formel:

\begin{equation*}
  \int_{x_w}^{x_e} f(x)dx = f_P(x_e-x_w)
+ \frac{1}{2} f'_P \left[{(x_e-x_P)^2-(x_w-x_P)^2}\right]
+ \frac{1}{6} f''_P \left[{{(x_e-x_P)}^3-{(x_w-x_P)}^3}\right] + HOT
\end{equation*}

Hier müssen nun die auftretenden Ableitungen durch einen Differenzenquotienten
beschrieben werden.

\begin{align*}
  f'_P &=\frac{f_E-f_W}{x_E-x_W} \\
  f''_P &= \frac{1}{x_e-x_w}\left(\frac{f_E-f_P}{x_E-x_P}-\frac{f_P-f_W}{x_P-x_W}\right)
\end{align*}

Der Truncation Error der Diskretisierung des Quelltermes lässt sich damit über die
folgende Gleichung beschrieben.

\begin{align}
  TE_{source} &=
 \frac{f_E-f_W}{2(x_E-x_W)}  \left[{(x_e-x_P)^2-(x_w-x_P)^2}\right]\nonumber\\
&+\frac{1}{6(x_e-x_w)}\left(\frac{f_E-f_P}{x_E-x_P}-\frac{f_P-f_W}{x_P-x_W}\right)
  \left[{{(x_e-x_P)}^3-{(x_w-x_P)}^3}\right] + HOT
\end{align}

\subsection{Äquidistante Gitter}

Für äquidistante Gitter vereinfacht sich der Term und es ergibt sich:

\begin{equation*}
  TE_{source} = \frac{\Delta x}{24} \left({f_E-2f_P+f_W}\right)
\end{equation*}

\section{Diffusionsterme}
\label{sec:Diffusionsterme}


Um den Truncation Error der Diffusionsterme zu bestimmen, leiten wir die Differenzenquotienten
für die Ableitungen erster Ordnung aus den Taylorreihendarstellungen her. Beispielhaft
soll das anhand des östlichen Randes des Kontrollvolumens geschehen.

Zuerst entwickeln wir die Taylordarstellungen vom Punkt $x_e$ aus in Richtung der anliegenden
Kontrollvolumenmittelpunkte.

\begin{align}
  \phi_E &= \phi_e + \phi'_e(x_E-x_e)+\frac{1}{2}\phi''_e(x_E-x_e)^2
  +\frac{1}{6}\phi'''_e(x_E-x_e)^3+HOT
  \label{eq:taylor_eE}\\
  \phi_P &= \phi_e + \phi'_e(x_P-x_e)+\frac{1}{2}\phi''_e(x_P-x_e)^2
  +\frac{1}{6}\phi'''_e(x_P-x_e)^3+HOT
  \label{eq:taylor_eP}
\end{align}

Wird nun Gleichung~\eqref{eq:taylor_eP} von Gleichung~\eqref{eq:taylor_eE} subtrahiert, 
so ergibt sich:

\begin{equation*}
  \phi_E-\phi_P=\phi'_e(x_E-x_P)+
  \frac{1}{2}\phi''_e\left[{{(x_E-x_e)}^2-{(x_P-x_e)}^2}\right]+
  \frac{1}{6}\phi'''_e\left[{{(x_E-x_e)}^3-{(x_P-x_e)}^3}\right]+HOT
\end{equation*}

Nach Umstellen ergibt sich daraus für die Ableitung $\phi'_e$ der folgende Term:

\begin{equation}
  \phi'_e = \frac{\phi_E-\phi_P}{x_E-x_P}+\frac{1}{2}\phi''_e
\left({\frac{{(x_P-x_e)}^2-{(x_E-x_e)}^2}{x_E-x_P}}\right)+
\frac{1}{6} \phi'''_e \left({\frac{{(x_P-x_e)}^3-{(x_E-x_e)}^3}{(x_E-x_P)}}\right)+HOT
\end{equation}


Die westliche Seite des Kontrollvolumens kann auf die gleiche Weise hergeleitet werden.
Damit verbleibt es, die auftretenden Ableitungen zu diskretisieren. Werden dafür
möglichst lokale Differenzenquotienten genutzt ergeben sich die folgenden Ausdrücke.

\begin{align*}
  \phi''_e &= \frac{1}{(x_E-x_P)}\left({
\frac{\phi_{EE}-\phi_P}{x_{EE}-x_P}-\frac{\phi_E-\phi_W}{x_E-x_W}}\right)\\
\phi'''_e &= \frac{1}{(x_E-x_P)}\left({
\frac{1}{(x_{ee}-x_e)}
\left({\frac{\phi_{EE}-\phi_E}{x_{EE}-x_E}-\frac{\phi_E-\phi_P}{x_E-x_P} }\right)
-\frac{1}{(x_e-x_w)}
\left({\frac{\phi_E-\phi_P}{x_E-x_P} - \frac{\phi_P-\phi_W}{x_P-x_W}  }\right)
}\right)
\end{align*}


Der Truncation Error des Diffusionsterms an der östlichen Grenze des Kontrollvolumens
lässt sich damit über folgende Gleichung beschreiben.

\begin{align*}
  {TE}_e &= \frac{1}{2 (x_E-x_P)}\left({
\frac{\phi_{EE}-\phi_P}{x_{EE}-x_P}-\frac{\phi_E-\phi_W}{x_E-x_W}}\right) \left({\frac{{(x_P-x_e)}^2-{(x_E-x_e)}^2}{x_E-x_P}}\right)\\
&+
\left({
\frac{1}{(x_{ee}-x_e)}
\left({\frac{\phi_{EE}-\phi_E}{x_{EE}-x_E}-\frac{\phi_E-\phi_P}{x_E-x_P} }\right)
-\frac{1}{(x_e-x_w)}
\left({\frac{\phi_E-\phi_P}{x_E-x_P} - \frac{\phi_P-\phi_W}{x_P-x_W}  }\right)
}\right)\\
&\frac{1}{6(x_E-x_P)}\left({\frac{{(x_P-x_e)}^3-{(x_E-x_e)}^3}{(x_E-x_P)}}\right)
+HOT
\end{align*}

Der Truncation Error im Westen ergibt sich äquivalent zu:

\begin{align*}
  \phi_P &= \phi_w + \phi'_w(x_P-x_w)+\frac{1}{2}\phi''_w(x_P-x_w)^2
  +\frac{1}{6}\phi'''_w(x_P-x_w)^3+HOT\\
  \phi_W &= \phi_w + \phi'_w(x_W-x_w)+\frac{1}{2}\phi''_w(x_W-x_w)^2
  +\frac{1}{6}\phi'''_w(x_W-x_w)^3+HOT
\end{align*}

\begin{equation}
  \phi'_w = \frac{\phi_P-\phi_W}{x_P-x_W}+\frac{1}{2}\phi''_w
\left({\frac{{(x_W-x_w)}^2-{(x_P-x_w)}^2}{x_P-x_W}}\right)+
\frac{1}{6} \phi'''_w \left({\frac{{(x_W-x_w)}^3-{(x_P-x_w)}^3}{(x_P-x_W)}}\right)+HOT
\end{equation}

\begin{align*}
  \phi''_w &= \frac{1}{(x_P-x_W)}\left({
\frac{\phi_{E}-\phi_W}{x_{E}-x_W}-\frac{\phi_P-\phi_{WW}}{x_P-x_{WW}}}\right)\\
 \phi'''_w &= \frac{1}{(x_P-x_W)}\left({
\frac{1}{(x_e-x_w)}
\left({\frac{\phi_E-\phi_P}{x_E-x_P}-\frac{\phi_P-\phi_W}{x_P-x_W} }\right)
-\frac{1}{(x_w-x_{ww})}
\left({\frac{\phi_P-\phi_W}{x_P-x_W} - \frac{\phi_W-\phi_{WW}}{x_W-x_{WW}}  }\right)
}\right)
\end{align*}

\begin{align*}
  TE_w &= \frac{1}{2 (x_P-x_W)} \left({
\frac{\phi_{E}-\phi_W}{x_{E}-x_W}-\frac{\phi_P-\phi_{WW}}{x_P-x_{WW}}}\right)
  \left({\frac{{(x_W-x_w)}^2-{(x_P-x_w)}^2}{x_P-x_W}}\right)\\
&+
\left({
\frac{1}{(x_e-x_w)}
\left({\frac{\phi_E-\phi_P}{x_E-x_P}-\frac{\phi_P-\phi_W}{x_P-x_W} }\right)
-\frac{1}{(x_w-x_{ww})}
\left({\frac{\phi_P-\phi_W}{x_P-x_W} - \frac{\phi_W-\phi_{WW}}{x_W-x_{WW}}  }\right)
}\right)\\
&\frac{1}{6(x_P-x_W)}\left({\frac{{(x_W-x_w)}^3-{(x_P-x_w)}^3}{(x_P-x_W)}}\right)
  +HOT
\end{align*}

\subsection{Äquidistante Gitter}

Für äquidistante Gitter vereinfache sich die Terme des Truncation Error. So löschen
sich beispielsweise die quadratischen Terme gegenseitig aus. Es ergeben sich die
folgenden Fehler:

\begin{align*}
  {TE}_e &= \left({
\frac{1}{6\Delta x^2}
\left({\frac{\phi_{EE}-\phi_E}{\Delta x}-\frac{\phi_E-\phi_P}{\Delta x} }\right)
-\frac{1}{6\Delta x^2}
\left({\frac{\phi_E-\phi_P}{\Delta x} - \frac{\phi_P-\phi_W}{\Delta x}  }\right)
}\right)\left({-\frac{\Delta x^2}{4} }\right)+HOT\\
&= -\frac{1}{24\Delta x}\left({
\phi_{EE}-3\phi_E+3\phi_P-\phi_W}\right)+HOT
\end{align*}

\begin{align*}
  TE_w &=\left({
\frac{1}{6 \Delta x^2}
\left({\frac{\phi_E-\phi_P}{\Delta x}-\frac{\phi_P-\phi_W}{\Delta x} }\right)
-\frac{1}{6\Delta x^2}
\left({\frac{\phi_P-\phi_W}{\Delta x} - \frac{\phi_W-\phi_{WW}}{\Delta x}  }\right)
}\right)
\left({-\frac{\Delta x^2}{4} }\right)+HOT\\
&= -\frac{1}{24 \Delta x}\left({
\phi_E-3\phi_P+3\phi_W-\phi_{WW}}\right)+HOT
\end{align*}


\subsection{Kontrollvolumen am Rand}

Wie man sieht, werden für die Differenzenquotienten die Funktionswerte benachbarter
Kontrollvolumen benötigt. Deshalb müssen die Approximationen der Ableitung für
Kontrollvolumen am Rand angepasst werden. Es ergeben sich für gegebenes $\phi_w$:

\begin{equation*}
  \phi''_{w, Rand} = \frac{1}{(x_P-x_w)}\left({
\frac{\phi_{e}-\phi_w}{x_{e}-x_w}-\frac{\phi_P-\phi_w}{x_P-x_w}}\right)
\end{equation*}

Hier wird noch der Wert $\phi_e$ benutzt, der aber nicht bekannt ist. Er wird deshalb
durch eine lineare Interploation von $\phi_E$ und $\phi_P$ bestimmt.

\begin{equation}
  \phi_e = \phi_P \frac{x_E-x_e}{x_E-x_P} + \phi_E \frac{x_e-x_P}{x_E-x_P}
\end{equation}

Damit ergibt sich für $\phi''_{w,Rand}$:

\begin{equation}
  \phi''_{w,Rand}  = \frac{1}{(x_P-x_w)}\left({
\frac{
  \left({\phi_P \frac{x_E-x_e}{x_E-x_P} + \phi_E \frac{x_e-x_P}{x_E-x_P}
}\right)
-\phi_w}{x_{e}-x_w}-\frac{\phi_P-\phi_w}{x_P-x_w}}\right)
\end{equation}

Äquivalent ergibt sich $\phi''_{e, Rand}$ bei gegebenem $\phi_e$:

\begin{equation*}
  \phi''_{e, Rand} = \frac{1}{(x_e-x_P)}\left({
\frac{\phi_{e}-\phi_P}{x_{e}-x_P}-\frac{\phi_e-\phi_w}{x_e-x_w}}\right)
\end{equation*}

$\phi_w$ wird wie folgt linear interpoliert:

\begin{equation*}
  \phi_w = \phi_W \frac{x_P-x_w}{x_P-x_W} + \phi_P \frac{x_w-x_W}{x_P-x_W}
\end{equation*}

Damit ergibt sich für $\phi''_{e,Rand}$:

\begin{equation}
  \phi''_{e,Rand} = \frac{1}{(x_e-x_P)}\left({
\frac{\phi_{e}-\phi_P}{x_{e}-x_P}-\frac{\phi_e-
  \left({
   \phi_W \frac{x_P-x_w}{x_P-x_W} + \phi_P \frac{x_w-x_W}{x_P-x_W}
  }\right)
}{x_e-x_w}}\right)
\end{equation}



\section{Konvektionsterme}

\begin{align}
  \phi_E &= \phi_e + \phi'_e(x_E-x_e)+\frac{1}{2}\phi''_e(x_E-x_e)^2
  +\frac{1}{6}\phi'''_e(x_E-x_e)^3+HOT
  \label{eq:taylor_konv_eE}\\
  \phi_P &= \phi_e + \phi'_e(x_P-x_e)+\frac{1}{2}\phi''_e(x_P-x_e)^2
  +\frac{1}{6}\phi'''_e(x_P-x_e)^3+HOT
  \label{eq:taylor_konv_eP}
\end{align}

Werden die Gleichungen~\eqref{eq:taylor_konv_eE} und \eqref{eq:taylor_konv_eP} addiert,
durch zwei dividiert und nach $\phi_e$ umgestellt



\section{Truncation Error eines Kontrollvolumens}
\label{sec:Truncation Error eines Kontrollvolumens}

Der Truncation Error für ein Kontrollvolumen setzt sich nun aus den Fehlern von Quell-
und Diffusionstermen zusammen:

\begin{equation*}
  TE = TE_{source} + TE_e + TE_w
\end{equation*}

Für den äquidistanten Fall ergibt sich damit für zentrale Kontrollvolumen der folgende
Truncation Error. Wichtig ist es, hier die durch den Gauß'schen Integralsatz 
entstehenden Vorzeichen mit zu beachten.

\begin{align}
  TE &= \frac{\Delta x}{24} \left({f_E-2f_P+f_W}\right)
   -\frac{1}{24\Delta x}\left({
\phi_{EE}-3\phi_E+3\phi_P-\phi_W}\right)
  +\frac{1}{24 \Delta x}\left({
\phi_E-3\phi_P+3\phi_W-\phi_{WW}}\right)
\end{align}

\begin{figure}[h]
\begin{tikzpicture}
    \begin{axis}[
        height=7cm,
        width=0.9*\textwidth,
        grid=major,
        xlabel=$x$,
        ylabel=TE,
%scaled y ticks = false,
    ]
    \addplot[tud2d, mark=*] file {te_20_aequi.txt};
    \end{axis}
\end{tikzpicture}
\caption{Truncation Error}
\end{figure}

\section{Randwerte}
\label{sec:Randwerte}

Für die Auswertung der Ableitungen an Randpunkten ist es nicht möglich zentrale Differenzenquotienten
zu finden, da man dazu Punkte außerhalb des betrachteten Gebietes einbeziehen müsste.

Stattdessen erstellt man für die Randpunkte Interpolationspolynome und leitet diese ab.
Sie können dann einfach an den gewünschten Punkten ausgewertet werden.

Will man eine zweite Ableitung diskretisieren, so muss das Interpolationspolynom
ebensfalls die Ordnung 2 haben, um genügend Ableitungen zur Verfügung zu stellen.
Verallgemeinert bedeutet dies, dass für eine n-te Ableitung ein Polynom vom Grad n
aufgestellt werden muss.

Das Aufstellen der Polynome kann zum Beispiel über die Lagrange-Formel erfolgen.
Für Polynomgrade größer zwei ist es sinnvoll ein CAS-System zur Berechnung zu verwenden.
Ein möglicher Weg soll hier für das Programmpaket Maxima aufgezeigt werden.

\begin{lstlisting}
  load(interpol);
  data: [[a, fa], [b, fb], [c, fc]];
  poly: lagrange(data);
  d_poly: diff(poly, x);
  
\end{lstlisting}

\end{document}

\documentclass[10pt, ngerman,colorback,accentcolor=tud2d]{tudreport}
\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}
\usepackage{amsmath}

\usepackage{microtype}

\usepackage{pgfplots}
\pgfplotsset{compat=1.8}

\begin{document}
%\tableofcontents
\chapter{1D-Diffusionsgleichung mit FVM}

\begin{equation} \label{base-formula}
\alpha \frac{\partial^2 \phi}{\partial x^2} = f
\end{equation}

Bei Integralbildung über den Bereich eines Kontrollvolumens von $x_w$ bis $x_e$
und der Anwendung des Gaußschen Integralsatzes kann das wie folgt umgeschrieben werden.

\begin{align*}
\int_{x_w}^{x_e}\alpha \frac{\partial^2 \phi}{\partial x^2} dx
&= \alpha \frac{\partial \phi}{\partial x}\Big|_{x_w}^{x_e}\\
&= \alpha \frac{\partial \phi}{\partial x}\Big|_{x_e}
 - \alpha \frac{\partial \phi}{\partial x}\Big|_{x_w}\\
&= \alpha (\phi'_e - \phi'_w)
\end{align*}

Nun müssen die auftretenden Ableitungen durch Variablenwerte in den Mittelpunkten
der Kontrollvolumen ausgedrückt werden.

\begin{equation*}
\int_{x_w}^{x_e}f dx \approx f_P (x_e - x_w)
\end{equation*}

\begin{equation*}
\phi'_e \approx \frac{\phi_E - \phi_P}{x_E - x_P}
\end{equation*}

\begin{equation*}
\phi'_w \approx \frac{\phi_P - \phi_W}{x_P - x_W}
\end{equation*}

Eingesetzt in Gleichung~\ref{base-formula} ergibt dies:

\begin{equation}
\alpha \frac{\phi_E - \phi_P}{x_E - x_P} + \alpha \frac{\phi_W - \phi_P}{x_W - x_P}
= f_P (x_e - x_w)
\end{equation}

Diese Gleichung kann in folgende Beziehung umgeformt werden.

\newcommand{\diffEP}{(x_E-x_P)}
\newcommand{\diffWP}{(x_W-x_P)}
\newcommand{\diffew}{(x_e-x_w)}

\begin{equation}
a_P \phi_P + a_E \phi_E + a_W \phi_W = b_P
\end{equation}

Die Koeffizienten $a_i$ und $b_P$ nehmen hierbei die folgenden Werte an.

\begin{align*}
  a_P &= -\left( \frac{\alpha}{\diffEP \diffew} + \frac{\alpha}{\diffWP \diffew} \right) \\
a_E &= \frac{\alpha}{\diffEP \diffew}\\
a_W &= \frac{\alpha}{\diffWP \diffew}\\
b_P &= f_P
\end{align*}

Für äquidistante Gitter ergeben sich vereinfachte Terme für die Koeffizienten $a$.

\begin{align*}
  a_W &= \frac{\alpha}{\Delta x^2} = a\\
  a_E &= \frac{\alpha}{\Delta x^2} = a\\
  a_P &= - \frac{2 \alpha}{\Delta x^2} = -2a
\end{align*}

Betrachtet man nun alle Kontrollvolumen, kann mit diesen Beziehungen ein 
Gleichungssystem der Form $A\phi = b$ aufgestellt werden.

\section{Randbedingungen}
\label{sec:Randbedingungen}

Es wird angenommen, das der Randwert $\phi_w= \phi^0$ gegeben ist. Damit kann die
Ableitung $\frac{\partial \phi}{\partial x}$ wie folgt approximiert werden:

\begin{equation*}
\left(\frac{\partial \phi}{\partial x}\right)_W = \frac{\phi_P - \phi_W}{x_P - x_W} =
  \frac{\phi_P - \phi^0}{x_P - x_w}
\end{equation*}

Die Koeffizienten für ein Randkontrollvolumen ergeben sich damit zu:

\begin{align*}
  a_W &= 0\\
  a_P &=  -\left( \frac{\alpha}{\diffEP \diffew} + \frac{\alpha}{\diffWP \diffew} \right) \\
  a_E &= \frac{\alpha}{\diffEP \diffew}\\
  b_P &= f_P - \frac{\alpha}{(x_P -x_w)\diffew}
\end{align*}

beziehungsweise für den äquidistanten Fall:

\begin{align*}
  a_W &= 0\\
  a_P &=  -\frac{3 \alpha}{\Delta x^2} = -3a\\
  a_E &= \frac{\alpha}{\Delta x^2} = a\\
  b_P &= f_P - \frac{\alpha}{\Delta x \cdot \frac{1}{2} \Delta x}\phi^0 = f_P - 
  \frac{2\alpha}{\Delta x^2} \phi^0 = f_P - 2a \phi^0
\end{align*}

\chapter{Manufactured Solution}

Wir wählen die folgende Lösung für $\phi$ und berechnen die Ableitungen.

\begin{align*}
  \phi(x) &= A + \sin(Bx)\\
  \phi'(x) &= B \cos(Bx)\\
  \phi''(x) &= -B^2\sin(Bx)
\end{align*}

Nun führen wir den zusätzlichen Quellterm $f_{ad}$ ein und setzen $\phi(x)$ ein.

\begin{equation*}
  \alpha\frac{\partial^2 \phi}{\partial x^2}-f=f_{ad}
\end{equation*}

so erhält man:

\begin{equation*}
  f_{ad} = -\alpha B^2\sin(BX)-f
\end{equation*}

Damit ergibt sich als Manufactured Solution:
\begin{align}
  \alpha\frac{\partial^2 \phi}{\partial x^2} &= f -\alpha B^2\sin(Bx)-f\\
                                             &= -\alpha B^2\sin(Bx)
\end{align}

\section{Randbedingungen}
\label{sec:Randbedingungen}

Um die Konstanten $A$ und $B$ in der Manufactured Solution bestimmen zu können,
müssen konkrete Randbedingungen für das Problem festgelegt werden. Beispielhaft
soll das hier mit den Randwerten $\phi(0) = 1$ und $\phi(1) = 2$ geschehen.
Damit ergeben sich die Konstanten zu $A = 1$ sowie $B = \frac{\pi}{2}$. Die 
konstruierte Lösung $\phi(x)$ hat damit die folgende Form und der Quellterm $f$
ergibt sich zu:
\begin{equation*}
  \phi(x) = 1 + \sin(\frac{\pi}{2}x)
\end{equation*}
\begin{equation*}
  f=-\frac{\pi^2}{4}\sin(\frac{\pi}{2}x)
\end{equation*}

\section{Konvergenzuntersuchung}
\label{sec:Konvergenzuntersuchung}

Der Fehler $E$ wird definiert als Differenz zwischen diskreter Lösung $f(\Delta)$ sowie
der exakten Lösung $f_{exakt}$.
\begin{equation*}
  E=f(\Delta) - f_{exakt}
\end{equation*}

Für finite Methoden der Ordnung $p$ sollte sich der Fehler $DE$ proportional zu
$h^p$ verhalten. Daraus folgt mit dem Proportionalitätskoeffizienten $C$:

\begin{equation*}
  DE=f(\Delta) - f_{exakt}=C h^p + HOT
\end{equation*}

Wird nun die Gitterweite $h$ systematisch verkleinert, so lässst sich der beobachtete
Genauigkeitsgrad $p$ wie folgt berechnen.

\begin{equation}
  p=\frac{\ln \left(\frac{DE_2}{DE_1}\right)}{\ln \left(\frac{h_2}{h_1}\right)}
\end{equation}

\scalebox{0.8}{\input{my_plot.tex}}

\begin{tikzpicture}
    \begin{axis}[
        height=9cm,
        width=0.9*\textwidth,
        grid=major,
        xlabel=$\sin x$,
        ylabel=Test,
    ]
    \addplot {-x^5 - 242};
    \addlegendentry{model}
    \addplot coordinates {
        (-4.77778,2027.60977)
        (-3.55556,347.84069)
        (-2.33333,22.58953)
        (-1.11111,-493.50066)
        (0.11111,46.66082)
        (1.33333,-205.56286)
        (2.55556,-341.40638)
        (3.77778,-1169.24780)
        (5.00000,-3269.56775)
    };
    \addlegendentry{estimate}
    \end{axis}
\end{tikzpicture}

\begin{tikzpicture}
    \begin{axis}[
        height=8cm,
        width=0.9*\textwidth,
        grid=major,
        xlabel=$x$,
        ylabel=$\phi$,
    ]
    \addplot[tud2d, mark=*] file {solution_20_aequi.txt};
    \end{axis}
\end{tikzpicture}

\begin{tikzpicture}
    \begin{axis}[
        height=8cm,
        width=0.9*\textwidth,
        grid=major,
        xlabel=$x$,
        ylabel=Fehler,
scaled y ticks = false,
    ]
    \addplot[tud2d, mark=*] file {error_20_aequi.txt};
    \end{axis}
\end{tikzpicture}

\chapter{Truncation Error}
\label{cha:Truncation Error}

\newcommand{\ab}{\frac{a+b}{2}}
\newcommand{\abk}{\left(\frac{a+b}{2}\right)}

\section{Quellterm}
\label{sec:Quellterm}


Die Taylorreihenentwicklung einer Funktion $f(x)$ um den Punkt $\ab$
liefert:

\begin{equation*}
  f(x) = f\abk +
  f'\abk\left(x-\ab\right) +
  \frac{1}{2}f''\abk{\left(x-\ab\right)}^2 + HOT
\end{equation*}

Nach Integration im Intervall $a$ bis $b$ ergibt sich für äquidistante Gitter:

\begin{align*}
  \int_a^b f(x) dx &= \int_a^b f\abk dx +
  \underbrace{\int_a^b f'\abk \left( x - \ab\right) dx}_{=0} +
  \int_a^b \frac{1}{2}f''\abk{\left(x-\ab\right)}^2 dx + HOT\\
  &= f\abk (b-a) + \frac{1}{6} f''\abk
  \left[\left( b-\ab \right)^3 - \left(a-\ab\right)^3 \right] + HOT
\end{align*}

Angewendet auf ein Kontrollvolumen ergibt sich daraus die folgende Formel:

\begin{equation*}
  \int_a^b f(x)dx = f_P(x_E-x_W) + \frac{1}{6} f''_P \left[{{(x_E-x_P)}^3-{(x_W-x_P)}^3}\right] + HOT
\end{equation*}

Hier muss nun die auftretende Ableitung durch einen Differenzenquotient beschriebn werden.

\begin{equation*}
  f''_P = \frac{1}{x_e-x_w}\left(\frac{f_E-f_P}{x_E-x_P}-\frac{f_P-f_W}{x_P-x_W}\right)
\end{equation*}

Der Truncation Error der Diskretisierung des Quelltermes lässt sich damit über die
folgende Gleichung beschrieben.

\begin{equation}
  TE = \frac{1}{6(x_e-x_w)}\left(\frac{f_E-f_P}{x_E-x_P}-\frac{f_P-f_W}{x_P-x_W}\right)
  \left[{{(x_E-x_P)}^3-{(x_W-x_P)}^3}\right] + HOT
\end{equation}


\section{Diffusionsterme}
\label{sec:Diffusionsterme}


Um den Truncation Error der Diffusionsterme zu bestimmen, leiten wir die Differenzenquotienten
für die Ableitungen erster Ordnung aus den Taylorreihendarstellungen her. Beispielhaft
soll das anhand des östlichen Randes des Kontrollvolumens geschehen.

Zuerst entwickeln wir die Taylordarstellungen vom Punkt $x_e$ aus in Richtung der anliegenden
Kontrollvolumenmittelpunkte.

\begin{align}
  \phi_E &= \phi_e + \phi'_e(x_E-x_e)+\frac{1}{2}\phi''_e(x_E-x_e)^2
  +\frac{1}{6}\phi'''_e(x_E-x_e)^3+HOT
  \label{eq:taylor_eE}\\
  \phi_P &= \phi_e + \phi'_e(x_P-x_e)+\frac{1}{2}\phi''_e(x_P-x_e)^2
  +\frac{1}{6}\phi'''_e(x_P-x_e)^3+HOT
  \label{eq:taylor_eP}
\end{align}

Wird nun Gleichung~\ref{eq:taylor_eP} von Gleichung~\ref{eq:taylor_eE} subtrahiert, 
so ergibt sich:

\begin{equation*}
  \phi_E-\phi_P=\phi'_e(x_E-x_P)+
  \frac{1}{2}\phi''_e\left[{{(x_E-x_e)}^2-{(x_P-x_e)}^2}\right]+
  \frac{1}{6}\phi'''_e\left[{{(x_E-x_e)}^3-{(x_P-x_e)}^3}\right]+HOT
\end{equation*}

Nach Umstellen ergibt sich daraus für die Ableitung $\phi'_e$ der folgende Term:

\begin{equation}
  \phi'_e = \frac{\phi_E-\phi_P}{x_E-x_P}+\frac{1}{2}\phi''_e
\left({\frac{{(x_P-x_e)}^2-{(x_E-x_e)}^2}{x_E-x_P}}\right)+
\frac{1}{6} \phi'''_e \left({\frac{{(x_P-x_e)}^3-{(x_E-x_e)}^3}{(x_E-x_P)}}\right)+HOT
\end{equation}


Die westliche Seite des Kontrollvolumens kann auf die gleiche Weise hergeleitet werden.
Damit verbleibt es, die auftretenden Ableitungen zu diskretisieren. Werden dafür
möglichst lokale Differenzenquotienten genutzt ergeben sich die folgenden Ausdrücke.

\begin{align*}
  \phi''_e &= \frac{1}{(x_E-x_P)}\left({
\frac{\phi_{EE}-\phi_P}{x_{EE}-x_P}-\frac{\phi_E-\phi_W}{x_E-x_W}}\right)\\
 \phi'''_e &= \dots
\end{align*}


Der Truncation Error des Diffusionsterms an der östlichen Grenze des Kontrollvolumens
lässt sich damit über folgende Gleichung beschreiben.

\begin{align*}
  {TE}_e &= \frac{1}{2 (x_E-x_P)}\left({
\frac{\phi_{EE}-\phi_P}{x_{EE}-x_P}-\frac{\phi_E-\phi_W}{x_E-x_W}}\right) \left({\frac{{(x_P-x_e)}^2-{(x_E-x_e)}^2}{x_E-x_P}}\right)+HOT
%&+\frac{1}{6 (x_E-x_P)}\left({
%\frac{\phi_{EE}-\phi_P}{x_{EE}-x_P}-\frac{\phi_E-\phi_W}{x_E-x_W}}\right) \left({\frac{{(x_P-x_e)}^3-{(x_E-x_e)}^3}{(x_E-x_P)}}\right)+HOT
\end{align*}

Der Truncation Error im Westen ergibt sich äquivalent zu:

\begin{align}
  \phi_P &= \phi_w + \phi'_w(x_P-x_w)+\frac{1}{2}\phi''_w(x_P-x_w)^2
  +\frac{1}{6}\phi'''_w(x_P-x_w)^3+HOT
  \label{eq:taylor_wP}\\
  \phi_W &= \phi_w + \phi'_w(x_W-x_w)+\frac{1}{2}\phi''_w(x_W-x_w)^2
  +\frac{1}{6}\phi'''_w(x_W-x_w)^3+HOT
  \label{eq:taylor_eP}
\end{align}

\begin{equation}
  \phi'_w = \frac{\phi_P-\phi_W}{x_P-x_W}+\frac{1}{2}\phi''_w
\left({\frac{{(x_W-x_w)}^2-{(x_P-x_w)}^2}{x_P-x_W}}\right)+
\frac{1}{6} \phi'''_w \left({\frac{{(x_W-x_w)}^3-{(x_P-x_w)}^3}{(x_P-x_W)}}\right)+HOT
\end{equation}

\begin{align*}
  \phi''_w &= \frac{1}{(x_P-x_W)}\left({
\frac{\phi_{E}-\phi_W}{x_{E}-x_W}-\frac{\phi_P-\phi_{WW}}{x_P-x_{WW}}}\right)\\
 \phi'''_w &= \dots
\end{align*}

\begin{align*}
  TE_w = \frac{1}{2 (x_P-x_W)} \left({
\frac{\phi_{E}-\phi_W}{x_{E}-x_W}-\frac{\phi_P-\phi_{WW}}{x_P-x_{WW}}}\right)
  \left({\frac{{(x_W-x_w)}^2-{(x_P-x_w)}^2}{x_P-x_W}}\right)+HOT
\end{align*}


Wie man sieht, werden für die Differenzenquotienten die Funktionswerte benachbarter
Kontrollvolumen benötigt. Deshalb müssen die Approximationen der Ableitung für
Kontrollvolumen am Rand angepasst werden. Es ergeben sich für gegebenes $\phi_w$:

\begin{equation*}
  \phi''_{w, Rand} = \frac{1}{(x_P-x_w)}\left({
\frac{\phi_{e}-\phi_w}{x_{e}-x_w}-\frac{\phi_P-\phi_w}{x_P-x_w}}\right)\\
\end{equation*}

Hier wird noch der Wert $\phi_e$ benutzt, der aber nicht bekannt ist. Er wird deshalb
durch eine lineare Interploation von $\phi_E$ und $\phi_P$ bestimmt.

\begin{equation}
  \phi_e = \phi_P \frac{x_E-x_e}{x_E-x_P} + \phi_E \frac{x_e-x_P}{x_E-x_P}
\end{equation}

Damit ergibt sich für $\phi_e$:

\begin{equation}
\phi_e  = \frac{1}{(x_P-x_w)}\left({
\frac{
  \left({\phi_P \frac{x_E-x_e}{x_E-x_P} + \phi_E \frac{x_e-x_P}{x_E-x_P}
}\right)
-\phi_w}{x_{e}-x_w}-\frac{\phi_P-\phi_w}{x_P-x_w}}\right)
\end{equation}

\end{document}
